<!DOCTYPE html>
<!-- saved from url=(0055)http://www.html5rocks.com/en/tutorials/file/filesystem/ -->
<html lang="en" dir="ltr" itemscope="" itemtype="http://schema.org/Article" class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths adownload webaudio no-battery blobconstructor contenteditable cors csscalc cssfilters mediaqueries no-regions classlist datalistelem details texttrackapi track filereader filesystem fullscreen getusermedia gamepads xhr2 quotamanagement performance raf no-stylescoped websocketsbinary no-webintents todataurljpeg todataurlwebp webp"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta property="twitter:account_id" content="1593210261">
  <!-- Copyright (c) 2012 Google Inc.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * Author: Eric Bidelman - e.bidelman@google.com
   *
   * 
   *
  -->
  <title>Exploring the FileSystem APIs - HTML5 Rocks</title>
  <meta name="description" content="The FileSystem APIs give applications the ability to read/write files and directories in a secure, sandboxed file system on a user&#39;s local machine.">
  <meta name="keywords" content="html5,html 5,html5 demos,html5 examples,javascript,css3,notifications,geolocation,web workers,apppcache,file api,filereader,indexeddb,offline,audio,video,drag and drop,chrome,sse,mobile">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="theme-color" content="#f04530">
  <link rel="shortcut icon" href="http://www.html5rocks.com/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="HTML5 Rocks RSS" href="http://feeds.feedburner.com/html5rocks">
  <meta name="google-site-verification" content="E1HOIDkksrWY5npenL8FeQhKn4Ujctd75iO2lfufSyA">
  <meta itemprop="name" content="Exploring the FileSystem APIs - HTML5 Rocks">
  <meta itemprop="description" content="The FileSystem APIs give applications the ability to read/write files and directories in a secure, sandboxed file system on a user&#39;s local machine.">
  
  <meta itemprop="image" content="http://www.html5rocks.com/static/images/html5rocks-logo-wings.png">
  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@ChromiumDev">
  <meta name="twitter:creator" content="@ebidel">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Exploring the FileSystem APIs - HTML5 Rocks">
  <meta property="og:url" content="http://www.html5rocks.com/en/tutorials/file/filesystem/">
  <meta property="og:description" content="The FileSystem APIs give applications the ability to read/write files and directories in a secure, sandboxed file system on a user&#39;s local machine.">
  <meta property="og:image" content="http://www.html5rocks.com/static/images/profiles/ericbidelman.png">
  <meta property="og:site_name" content="HTML5 Rocks - A resource for open web HTML5 developers">
  

  
  <link rel="author" href="https://www.google.com/profiles/118075919496626375791">
  
  
  <link rel="publisher" href="https://plus.google.com/+GoogleChromeDevelopers">

  
  
  <link rel="alternate" hreflang="de" href="http://www.html5rocks.com/de/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="es" href="http://www.html5rocks.com/es/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="it" href="http://www.html5rocks.com/it/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="ja" href="http://www.html5rocks.com/ja/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="pt" href="http://www.html5rocks.com/pt/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="ru" href="http://www.html5rocks.com/ru/tutorials/file/filesystem/">
  
  <link rel="alternate" hreflang="zh" href="http://www.html5rocks.com/zh/tutorials/file/filesystem/">
  
  

  
    
    <link rel="stylesheet" media="all" href="./Exploring the FileSystem APIs - HTML5 Rocks_files/v2-combined.min.css">
    

    
  

  <link href="./Exploring the FileSystem APIs - HTML5 Rocks_files/css" rel="stylesheet">

  <link rel="apple-touch-icon" href="http://www.html5rocks.com/static/images/identity/HTML5_Badge_64.png">
  <link rel="apple-touch-icon-precomposed" href="http://www.html5rocks.com/static/images/identity/HTML5_Badge_64.png">

  <script type="text/javascript" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/count.js" async=""></script><script type="text/javascript" async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/analytics.js"></script><script type="text/javascript" async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/analytics.js"></script><script async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/gtm.js"></script><script async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/analytics.js"></script><script async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/gtm.js"></script><script src="./Exploring the FileSystem APIs - HTML5 Rocks_files/modernizr.custom.82437.js"></script>

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5-els.js"></script>
  <![endif]-->

  
<style>

</style>

<script src="./Exploring the FileSystem APIs - HTML5 Rocks_files/count-data.js"></script></head>
<body data-href="tutorials-file-filesystem" onload="" class="article tutorial">

  <header class="main" id="siteheader">
    <h1 id="title">
      <a href="http://www.html5rocks.com/en/" title="HTML5 Rocks">HTML5 Rocks</a>
    </h1>
    <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#sitenav" id="navtoggle">Show navigation</a>

    
    <a id="toctoggle" href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc">Table of Contents</a>
    

    <nav id="sitenav">
      <ul>
        
        <li id="home_menu"><a href="http://www.html5rocks.com/en/" class="home">Home</a></li>
        
        <li id="tutorials_menu"><a href="http://www.html5rocks.com/en/tutorials/?page=1" class="tutorials">Tutorials</a></li>
        <li id="updates_menu"><a href="http://updates.html5rocks.com/" class="updates">Updates</a></li>
      </ul>
    </nav>

    
    <nav class="toc" id="toc">
      <h1>Table of Contents</h1>

      <ul><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-introduction">Introduction</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-requesting">Requesting a file system</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-file">Working with files</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-dir">Working with directories</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-copy-rename-move">Copying, renaming, and moving</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-filesystemurls">filesystem: URLs</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-dir-fullexample">Putting it all together</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-usecases">Use Cases</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-references">Reference specifications</a></li></ul>

      <h1 class="visible-title">Localizations:</h1>
      <ul>
        
          
          <li><a href="http://www.html5rocks.com/de/tutorials/file/filesystem/">Deutsch</a></li>
          
          <li><a href="http://www.html5rocks.com/es/tutorials/file/filesystem/">Español</a></li>
          
          <li><a href="http://www.html5rocks.com/it/tutorials/file/filesystem/">Italiano</a></li>
          
          <li><a href="http://www.html5rocks.com/ja/tutorials/file/filesystem/">日本語</a></li>
          
          <li><a href="http://www.html5rocks.com/pt/tutorials/file/filesystem/">Português (Brasil)</a></li>
          
          <li><a href="http://www.html5rocks.com/ru/tutorials/file/filesystem/">Pусский</a></li>
          
          <li><a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/">中文 (简体)</a></li>
          
          <li><a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md">Contribute another</a></li>
        
      </ul>
    </nav>
    
  </header>

  <div class="body-content">
    

  <section class="title">

    

    <section class="title-text container">
      
      <h1>Exploring the FileSystem APIs</h1>
      
      

      <a href="http://www.html5rocks.com/en/" class="watermark">HTML5 Rocks</a>
    </section>
  </section>

  <article class="content-wrapper">

    <section class="container">

      

      <div class="article-meta sticky" id="article-meta" style="top: 22px;">
        <nav class="toc">
          <h1>Table of Contents</h1>

          <ul><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-introduction">Introduction</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-requesting">Requesting a file system</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-file">Working with files</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-dir">Working with directories</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-copy-rename-move">Copying, renaming, and moving</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-filesystemurls">filesystem: URLs</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-dir-fullexample">Putting it all together</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-usecases">Use Cases</a></li><li><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-references">Reference specifications</a></li></ul>
        </nav>

        <aside class="localizations">
          <h1>Localizations</h1>
          <ul>
            
              
              <li><a href="http://www.html5rocks.com/de/tutorials/file/filesystem/">Deutsch</a></li>
              
              <li><a href="http://www.html5rocks.com/es/tutorials/file/filesystem/">Español</a></li>
              
              <li><a href="http://www.html5rocks.com/it/tutorials/file/filesystem/">Italiano</a></li>
              
              <li><a href="http://www.html5rocks.com/ja/tutorials/file/filesystem/">日本語</a></li>
              
              <li><a href="http://www.html5rocks.com/pt/tutorials/file/filesystem/">Português (Brasil)</a></li>
              
              <li><a href="http://www.html5rocks.com/ru/tutorials/file/filesystem/">Pусский</a></li>
              
              <li><a href="http://www.html5rocks.com/zh/tutorials/file/filesystem/">中文 (简体)</a></li>
              
              <li><a href="https://github.com/html5rocks/www.html5rocks.com/blob/master/CONTRIBUTING.md">Contribute another</a></li>
            
          </ul>
        </aside>
      </div>
      

      <div class="content" id="article-content">

        <section class="byline">

          <div class="byline-content">
            
            <section class="author-images">
              <a href="http://www.html5rocks.com/profiles/#ericbidelman">
                <img src="./Exploring the FileSystem APIs - HTML5 Rocks_files/ericbidelman.png" itemprop="photo" alt="Eric Bidelman" title="Eric Bidelman">
              </a>

              
            </section>

            <section class="meta">
              <div class="authors">
                <strong>By</strong> <a href="http://www.html5rocks.com/profiles/#ericbidelman">Eric Bidelman</a>
                
              </div>

              

              <div class="date">
                <time pubdate=""><strong>Published:</strong> January 4th, 2011</time>
                
                <time class="updated"><strong>Updated:</strong> July 30th, 2013</time>
                <span><strong>Comments:</strong> <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#disqus_thread" class="load-comments" data-disqus-identifier="http://www.html5rocks.com/tutorials/file/filesystem/">156</a></span>
              </div>

              <div id="notcompatible" class="hidden">
                Your browser may not support the functionality in this article.
              </div>
            </section>
            <div class="clear"></div>

            
          </div>
        </section>

        
  <p class="notice warning" style="text-align:center">
  In April 2014, it was <a href="http://lists.w3.org/Archives/Public/public-webapps/2014AprJun/0010.html">announced on public-webapps</a> 
  that the Filesystem API spec is not being considered by other browsers. For now, the API is Chrome-specific and it's unlikely to be implemented by other browsers and is no longer being standardized with the W3C.</p>

  <h2 id="toc-introduction">Introduction</h2>
  <p>I've always thought it would be handy if web applications could read and
  write files and directories. As we move from offline to online, applications are becoming
  more complex and the lack of file system APIs has been a hindrance for moving the web
  forward. Storing or interacting with binary data shouldn't be limited to the
  desktop. Thankfully, it no longer is thanks to the
  <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/">FileSystem API</a>.
  With the FileSystem API, a web app can create, read, navigate, and write to a
  sandboxed section of the user's local file system.</p>

  <p>The API is broken up into various themes:</p>
  <ul>
    <li>Reading and manipulating files:
      <code>File</code>/<code>Blob</code>, <code>FileList</code>, <code>FileReader</code></li>
    <li>Creating and writing:
      <code>Blob()</code>, <code>FileWriter</code></li>
    <li>Directories and file system access:
      <code>DirectoryReader</code>, <code>FileEntry</code>/<code>DirectoryEntry</code>, <code>LocalFileSystem</code>
    </li>
  </ul>

  <h3 id="toc-support">Browser support &amp; storage limitations</h3>

  <p>At the time of writing this article, Google Chrome has the only working implementation of the
  FileSystem API. A dedicated browser UI does not yet exist for file/quota
  management. To store data on the user's system, may require your app to <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-requesting-quota">request quota</a>.
  However, for testing, Chrome can be run with the <code>--unlimited-quota-for-files</code> flag.
  Furthermore, if you're building an app or extension for the Chrome Web Store, the <code>unlimitedStorage</code> <a href="http://code.google.com/chrome/extensions/manifest.html">manifest file</a>
  permission can be used in place of requesting quota. Eventually, users will receive a permission
  dialog to grant, deny, or increase storage for an app.</p>

  <p>You may need the <code>--allow-file-access-from-files</code> flag if you're debugging
  your app from <code>file://</code>. Not using these flags will result in
  a <code>SECURITY_ERR</code> or <code>QUOTA_EXCEEDED_ERR</code> FileError.</p>

  <h2 id="toc-requesting">Requesting a file system</h2>

  <p>A web app can request access to a sandboxed file system by calling
  <code>window.requestFileSystem()</code>:</p>

  <pre class="prettyprint"><span class="com">// Note: The file system has been prefixed as of Google Chrome 12:</span><span class="pln">
window</span><span class="pun">.</span><span class="pln">requestFileSystem  </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">requestFileSystem </span><span class="pun">||</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">webkitRequestFileSystem</span><span class="pun">;</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><var><span class="pln">type</span></var><span class="pun">,</span><span class="pln"> </span><var><span class="pln">size</span></var><span class="pun">,</span><span class="pln"> </span><var><span class="pln">successCallback</span></var><span class="pun">,</span><span class="pln"> </span><var><span class="pln">opt_errorCallback</span></var><span class="pun">)</span></pre>

  <dl>
    <dt><var>type</var></dt>
    <dd>Whether the file storage should be persistent.
    Possible values are <code>window.TEMPORARY</code> or <code>window.PERSISTENT</code>.
    Data stored using <code>TEMPORARY</code> can be removed at the browser's discretion
    (for example if more space is needed). <code>PERSISTENT</code> storage cannot be cleared
    unless explicitly authorized by the user or the app and requires the user to grant
    quota to your app. See <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-requesting-quota">requesting quota</a>.</dd>
    <dt><var>size</var></dt>
    <dd>Size (in bytes) the app will require for storage.</dd>
    <dt><var>successCallback</var></dt>
    <dd>Callback that is invoked on successful request of a file system. Its argument
    is a <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#idl-def-FileSystem"><code>FileSystem</code></a> object.</dd>
    <dt><var>opt_errorCallback</var></dt>
    <dd>Optional callback for handling errors or when the request to obtain
    the file system is denied. Its argument is a
    <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#idl-def-FileError"><code>FileError</code></a> object.</dd>
  </dl>

  <p>If you're calling <code>requestFileSystem()</code> for the first time, new storage is
  created for your app. It's important to remember that this file system is
  sandboxed, meaning one web app cannot access another app's files. This also
  means you cannot read/write files to an arbitrary folder on the user's hard drive
  (for example My Pictures, My Documents, etc.).</p>

  <p>Example usage:</p>
  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Opened file system: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> fs</span><span class="pun">.</span><span class="pln">name</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><b><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span></b><span class="pun">(</span><b><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span></b><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pln"> </span><span class="com">/*5MB*/</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <p>The FileSystem specification also defines a synchronous API, <code><a href="http://dev.w3.org/2009/dap/file-system/file-dir-sys.html#using-localfilesystemsync">LocalFileSystemSync</a></code>
  interface that is intended to be used in <a href="http://www.html5rocks.com/tutorials/#workers">Web Workers</a>.
  However, this tutorial will not cover the synchronous API.</p>

  <p>Throughout the remainder of this document, we'll use the same handler for
  processing errors from the asynchronous calls:</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> errorHandler</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">;</span><span class="pln">

  </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><b><span class="typ">FileError</span><span class="pun">.</span><span class="pln">QUOTA_EXCEEDED_ERR</span></b><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'QUOTA_EXCEEDED_ERR'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><b><span class="typ">FileError</span><span class="pun">.</span><span class="pln">NOT_FOUND_ERR</span></b><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'NOT_FOUND_ERR'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><b><span class="typ">FileError</span><span class="pun">.</span><span class="pln">SECURITY_ERR</span></b><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SECURITY_ERR'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><b><span class="typ">FileError</span><span class="pun">.</span><span class="pln">INVALID_MODIFICATION_ERR</span></b><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'INVALID_MODIFICATION_ERR'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><b><span class="typ">FileError</span><span class="pun">.</span><span class="pln">INVALID_STATE_ERR</span></b><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'INVALID_STATE_ERR'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
      msg </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Unknown Error'</span><span class="pun">;</span><span class="pln">
      </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">

  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Error: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> msg</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></pre>

  <p>Granted, this error callback is very generic, but you get the idea. You'll want to
  provide human-readable messages to users instead.</p>

  <h3 id="toc-requesting-quota">Requesting storage quota</h3>

  <p>To use <code>PERSISTENT</code> storage, you must obtain permission from the user
  to store peristent data. The same restriction doesn't apply to <code>TEMPORARY</code> storage
  because the browser may choose to evict temporarily stored data at its discretion.</p>

  <p>To use <code>PERSISTENT</code> storage with the FileSystem API, Chrome exposes a new
  API under <code>window.webkitStorageInfo</code> to request storage:</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">webkitStorageInfo</span><span class="pun">.</span><span class="pln">requestQuota</span><span class="pun">(</span><span class="pln">PERSISTENT</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">grantedBytes</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">PERSISTENT</span><span class="pun">,</span><span class="pln"> grantedBytes</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Error'</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span><span class="pln">
</span><span class="pun">});</span></pre>

  <p>Once the user has granted permission, there's no need to call <code>requestQuota()</code>
  in the future (unless you wish to increase your app's quota).
  Subsequent calls for equal or lesser quota are a noop.</p>

  <p>There is also <a href="https://groups.google.com/a/chromium.org/group/chromium-html5/browse_thread/thread/9be7a2dc04d9af67">an API</a> to query an origin's current quota
  usage and allocation: <code>window.webkitStorageInfo.queryUsageAndQuota()</code></p>

  <h2 id="toc-file">Working with files</h2>

  <p>Files in the sandboxed environment are represented by the
  <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-fileentry-interface"><code>FileEntry</code></a>
  interface. A FileEntry contains the types of properties (<code>name</code>, <code>isFile</code>, ...)
  and methods (<code>remove</code>, <code>moveTo</code>, <code>copyTo</code>, ...) that
  you'd expect from a standard file system.</p>

  <p id="toc-fileentry">Properties and methods of <code>FileEntry</code>:</p>
  <pre class="prettyprint"><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">isFile </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">isDirectory </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">name
fileEntry</span><span class="pun">.</span><span class="pln">fullPath
</span><span class="pun">...</span><span class="pln">

fileEntry</span><span class="pun">.</span><span class="pln">getMetadata</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">moveTo</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">,</span><span class="pln"> opt_newName</span><span class="pun">,</span><span class="pln"> opt_successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">copyTo</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">,</span><span class="pln"> opt_newName</span><span class="pun">,</span><span class="pln"> opt_successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">getParent</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">toURL</span><span class="pun">(</span><span class="pln">opt_mimeType</span><span class="pun">);</span><span class="pln">

fileEntry</span><span class="pun">.</span><span class="pln">file</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
fileEntry</span><span class="pun">.</span><span class="pln">createWriter</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
</span><span class="pun">...</span></pre>

  <p>To better understand <code>FileEntry</code>, the rest of this section contains
  a bunch of recipes for performing common tasks.

  </p><h3 id="toc-file-creatingempty">Creating a file</h3>

  <p>You can look up or create a file with the file system's <code>getFile()</code> method,
  a method of the <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-direntry">DirectoryEntry</a> interface.
  After requesting a file system, the success callback is passed a <code>FileSystem</code>
  object that contains a <code>DirectoryEntry</code> (<code>fs.root</code>) pointing to
  the root of the app's file system.</p>

  <p>The following code creates an empty file called "log.txt" in the root of the app's file system:</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><b><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span></b><span class="pun">(</span><span class="str">'log.txt'</span><span class="pun">,</span><span class="pln"> </span><b><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> exclusive</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}</span></b><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">// fileEntry.isFile === true</span><span class="pln">
    </span><span class="com">// fileEntry.name == 'log.txt'</span><span class="pln">
    </span><span class="com">// fileEntry.fullPath == '/log.txt'</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <p>Once the file system has been requested, the success handler is passed
  a <code>FileSystem</code> object. Inside the callback, we can call <code>fs.root.getFile()</code>
  with the name of the file to create. You can pass an absolute or relative path, but
  it must be valid. For instance, it is an error to attempt to create a file
  whose immediate parent does not exist. The second argument to <code>getFile()</code>
  is an object literal describing the function's behavior if the file does not exist. In this
  example, <code>create: true</code> creates the file if it doesn't exist
  and throws an error if it does (<code>exclusive: true</code>). Otherwise (if
  <code>create: false</code>), the file is simply fetched and returned.
  In either case, the file contents are not overwritten because we're just obtaining a
  reference entry to the file in question.</p>

  <h3 id="toc-file-readingbyname">Reading a file by name</h3>

  <p>The following code retrieves the file called "log.txt",
  its contents are read using the <code>FileReader</code> API and appended to a new
  &lt;textarea&gt; on the page. If log.txt doesn't exist,
  an error is thrown.</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><b><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span></b><span class="pun">(</span><span class="str">'log.txt'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">// Get a File object representing the file,</span><span class="pln">
    </span><span class="com">// then use FileReader to read its contents.</span><span class="pln">
    fileEntry</span><span class="pun">.</span><b><span class="pln">file</span></b><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="kwd">var</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FileReader</span><span class="pun">();</span><span class="pln">

       reader</span><span class="pun">.</span><span class="pln">onloadend </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         </span><span class="kwd">var</span><span class="pln"> txtArea </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'textarea'</span><span class="pun">);</span><span class="pln">
         txtArea</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">result</span><span class="pun">;</span><span class="pln">
         document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">txtArea</span><span class="pun">);</span><span class="pln">
       </span><span class="pun">};</span><span class="pln">

       reader</span><span class="pun">.</span><span class="pln">readAsText</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h3 id="toc-file-writing">Writing to a file</h3>

  <p>The following code creates an empty file called "log.txt" (if it doesn't exist)
  and fills it with the text 'Lorem Ipsum'.</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><b><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span></b><span class="pun">(</span><span class="str">'log.txt'</span><span class="pun">,</span><span class="pln"> </span><b><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}</span></b><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">// Create a FileWriter object for our FileEntry (log.txt).</span><span class="pln">
    </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">createWriter</span></b><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileWriter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

      </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">onwriteend</span></b><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Write completed.'</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">};</span><span class="pln">

      </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">onerror</span></b><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Write failed: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span><span class="pln">
      </span><span class="pun">};</span><span class="pln">

      </span><span class="com">// Create a new Blob and write it to log.txt.</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> blob </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Blob</span><span class="pun">([</span><span class="str">'Lorem Ipsum'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">{</span><span class="pln">type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'text/plain'</span><span class="pun">});</span><span class="pln">

      </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">write</span></b><span class="pun">(</span><span class="pln">blob</span><span class="pun">);</span><span class="pln">

    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <p>This time, we call the FileEntry's <code>createWriter()</code> method to
  obtain a <code>FileWriter</code> object. Inside the success callback, event
  handlers are set up for <code>error</code> and <code>writeend</code> events.
  The text data is written to the file by creating a blob, appending text to it,
  and passing the blob to <code>FileWriter.write()</code>.</p>

  <h3 id="toc-file-appending">Appending data to a file</h3>

  <p>The following code appends the text 'Hello World' to the end of our log file.
  An error is thrown if the file does not exist.</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><b><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span></b><span class="pun">(</span><span class="str">'log.txt'</span><span class="pun">,</span><span class="pln"> </span><b><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">}</span></b><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="com">// Create a FileWriter object for our FileEntry (log.txt).</span><span class="pln">
    fileEntry</span><span class="pun">.</span><span class="pln">createWriter</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileWriter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

      </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">seek</span><span class="pun">(</span><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">length</span><span class="pun">);</span><span class="pln"> </span><span class="com">// Start write position at EOF.</span></b><span class="pln">

      </span><span class="com">// Create a new Blob and write it to log.txt.</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> blob </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Blob</span><span class="pun">([</span><span class="str">'Hello World'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">{</span><span class="pln">type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'text/plain'</span><span class="pun">});</span><span class="pln">

      </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">write</span></b><span class="pun">(</span><span class="pln">blob</span><span class="pun">);</span><span class="pln">

    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h3 id="toc-file-user-selected">Duplicating user-selected files</h3>

  <p>The following code allows a user to select multiple files using
  <code>&lt;input type="file" multiple /&gt;</code> and creates copies of those
  files in the app's sandboxed file system.</p>

  <pre class="prettyprint"><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"myfile"</span><span class="pln"> </span><b><span class="atn">multiple</span></b><span class="pln"> </span><span class="tag">/&gt;</span></pre>

  <pre class="prettyprint"><span class="pln">document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#myfile'</span><span class="pun">).</span><span class="pln">onchange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> files </span><span class="pun">=</span><span class="pln"> </span><b><span class="kwd">this</span><span class="pun">.</span><span class="pln">files</span></b><span class="pun">;</span><span class="pln">

  window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Duplicate each file the user selected to the app's fs.</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> file</span><span class="pun">;</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> files</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

      </span><span class="com">// Capture current iteration's file in local scope for the getFile() callback.</span><span class="pln">
      </span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><b><span class="pln">f</span><span class="pun">.</span><span class="pln">name</span></b><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> exclusive</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          fileEntry</span><span class="pun">.</span><span class="pln">createWriter</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileWriter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><b><span class="pln">fileWriter</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="pln">f</span><span class="pun">);</span></b><span class="pln"> </span><span class="com">// Note: write() can take a File or Blob object.</span><span class="pln">
          </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
      </span><span class="pun">})(</span><span class="pln">file</span><span class="pun">);</span><span class="pln">

    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

</span><span class="pun">};</span></pre>

  <p>Although we've used an input for the file import, one could easily leverage
  <a href="http://www.html5rocks.com/tutorials/dnd/basics/#toc-desktop-dnd-into">HTML5 Drag and Drop</a>
  to achieve the same objective.</p>

  <p>As noted in the comment, <code>FileWriter.write()</code> can accept a <code>Blob</code>
  or <code>File</code>. This is because <code>File</code> inherits from <code>Blob</code>.
  Therefore, all file objects are blobs.</p>

  <h3 id="toc-file-removing">Removing a file</h3>

  <p>The following code deletes the file 'log.txt'.</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="str">'log.txt'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'File removed.'</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></b><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h2 id="toc-dir">Working with directories</h2>

  <p>Directories in the sandbox are represented by the
  <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-directoryentry-interface"><code>DirectoryEntry</code></a>
  interface, which shares most of <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-fileentry">FileEntry</a>'s properties
  (they inherit from a common <code>Entry</code> interface). However, <code>DirectoryEntry</code>
  has additional methods for manipulating directories.</p>

  <p>Properties and methods of <code>DirectoryEntry</code>:</p>
  <pre class="prettyprint"><span class="pln">dirEntry</span><span class="pun">.</span><span class="pln">isDirectory </span><span class="pun">===</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="com">// See the section on </span><a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-fileentry"><span class="com">FileEntry</span></a><span class="com"> for other inherited properties/methods.</span><span class="pln">
</span><span class="pun">...</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> dirReader </span><span class="pun">=</span><span class="pln"> dirEntry</span><span class="pun">.</span><span class="pln">createReader</span><span class="pun">();</span><span class="pln">
dirEntry</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> opt_flags</span><span class="pun">,</span><span class="pln"> opt_successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
dirEntry</span><span class="pun">.</span><span class="pln">getDirectory</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> opt_flags</span><span class="pun">,</span><span class="pln"> opt_successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
dirEntry</span><span class="pun">.</span><span class="pln">removeRecursively</span><span class="pun">(</span><span class="pln">successCallback</span><span class="pun">,</span><span class="pln"> opt_errorCallback</span><span class="pun">);</span><span class="pln">
</span><span class="pun">...</span></pre>

  <h3 id="toc-dir-creating">Creating directories</h3>

  <p>Use the <code>getDirectory()</code> method of <code>DirectoryEntry</code>
  to read or create directories. You can pass either a name or path as
  the directory to look up or create.</p>

  <p>For example, the following code creates a directory named "MyPictures" in the
  root directory:</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><b><span class="pln">getDirectory</span></b><span class="pun">(</span><span class="str">'MyPictures'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
  </span></pre>

  <h3 id="toc-dir-subirs">Subdirectories</h3>

  <p>Creating a subdirectory is exactly the same as creating any other directory. However,
  the API throws an error if you attempt to create a directory whose immediate
  parent does not exist. The solution is to create each directory sequentially, which
  is rather tricky to do with an asynchronous API.</p>

  <p>The following code creates a new hierarchy (music/genres/jazz) in the
  root of the app's FileSystem by recursively adding each subdirectory after its
  parent folder has been created.</p>

  <pre class="prettyprint"><span class="kwd">var</span><span class="pln"> path </span><span class="pun">=</span><span class="pln"> </span><span class="str">'music/genres/jazz/'</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> createDir</span><span class="pun">(</span><span class="pln">rootDirEntry</span><span class="pun">,</span><span class="pln"> folders</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Throw out './' or '/' and move on to prevent something like '/foo/.//bar'.</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">folders</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'.'</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> folders</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    folders </span><span class="pun">=</span><span class="pln"> folders</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  rootDirEntry</span><span class="pun">.</span><b><span class="pln">getDirectory</span></b><span class="pun">(</span><span class="pln">folders</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> </span><b><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}</span></b><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// Recursively add the new subfolder (if we still have another to create).</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">folders</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      createDir</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">,</span><span class="pln"> folders</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">1</span><span class="pun">));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  createDir</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">));</span><span class="pln"> </span><span class="com">// fs.root is a DirectoryEntry.</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <p>Now that "music/genres/jazz" is in place, we can pass its full path
  to <code>getDirectory()</code> and create new subfolders or files under it.
  For example:</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="str">'/music/genres/jazz/song.mp3'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">create</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h3 id="toc-dir-reading">Reading a directory's contents</h3>

  <p>To read the contents of a directory, create a <code>DirectoryReader</code>
  and call its <code>readEntries()</code> method. There is no
  guarantee that all of a directory's entries will be returned
  in a single call to <code>readEntries()</code>. That means you need to keep calling
  <code>DirectoryReader.readEntries()</code> until no more results are returned.
  The following is code that demonstrates this:</p>

  <pre class="prettyprint"><span class="tag">&lt;ul</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"filelist"</span><span class="tag">&gt;&lt;/ul&gt;</span></pre>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> toArray</span><span class="pun">(</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">list </span><span class="pun">||</span><span class="pln"> </span><span class="pun">[],</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> listResults</span><span class="pun">(</span><span class="pln">entries</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Document fragments can improve performance since they're only appended</span><span class="pln">
  </span><span class="com">// to the DOM once. Only one browser reflow occurs.</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> fragment </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createDocumentFragment</span><span class="pun">();</span><span class="pln">

  entries</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">entry</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> img </span><span class="pun">=</span><span class="pln"> </span><b><span class="pln">entry</span><span class="pun">.</span><span class="pln">isDirectory</span></b><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'&lt;img src="folder-icon.gif"&gt;'</span><span class="pln"> </span><span class="pun">:</span><span class="pln">
                                  </span><span class="str">'&lt;img src="file-icon.gif"&gt;'</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> li </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'li'</span><span class="pun">);</span><span class="pln">
    li</span><span class="pun">.</span><span class="pln">innerHTML </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">img</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">,</span><span class="pln"> entry</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">].</span><span class="pln">join</span><span class="pun">(</span><span class="str">''</span><span class="pun">);</span><span class="pln">
    fragment</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">li</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">

  document</span><span class="pun">.</span><span class="pln">querySelector</span><span class="pun">(</span><span class="str">'#filelist'</span><span class="pun">).</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">fragment</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">function</span><span class="pln"> onInitFs</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

  </span><span class="kwd">var</span><span class="pln"> dirReader </span><span class="pun">=</span><span class="pln"> </span><b><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">createReader</span><span class="pun">()</span></b><span class="pun">;</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> entries </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln">

  </span><span class="com">// Call the reader.readEntries() until no more results are returned.</span><span class="pln">
  </span><span class="kwd">var</span><span class="pln"> readEntries </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
     </span><b><span class="pln">dirReader</span><span class="pun">.</span><span class="pln">readEntries </span></b><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">results</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">results</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        listResults</span><span class="pun">(</span><span class="pln">entries</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">());</span><span class="pln">
      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        entries </span><span class="pun">=</span><span class="pln"> entries</span><span class="pun">.</span><span class="pln">concat</span><span class="pun">(</span><span class="pln">toArray</span><span class="pun">(</span><span class="pln">results</span><span class="pun">));</span><span class="pln">
        readEntries</span><span class="pun">();</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">

  readEntries</span><span class="pun">();</span><span class="pln"> </span><span class="com">// Start reading dirs.</span><span class="pln">

</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> onInitFs</span><span class="pun">,</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h3 id="toc-dir-removing">Removing a directory</h3>

  <p>The <code>DirectoryEntry.remove()</code> method behaves just like
  <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-file-removing"><code>FileEntry</code></a>'s. The difference:
  attempting to delete a non-empty directory results in an error.</p>

  <p>The following removes the empty directory "jazz" from "/music/genres/":</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getDirectory</span><span class="pun">(</span><span class="str">'music/genres/jazz'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><b><span class="pln">dirEntry</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Directory removed.'</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></b><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h4 id="toc-dir-rremoving">Recursively removing a directory</h4>

  <p>If you have a pesky directory that contains entries, <code>removeRecursively()</code>
  is your friend. It deletes the directory and its contents, recursively.</p>

  <p>The following code recursively removes the directory "music" and all the
  files and directories that it contains:</p>

  <pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getDirectory</span><span class="pun">(</span><span class="str">'/misc/../music'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><b><span class="pln">dirEntry</span><span class="pun">.</span><span class="pln">removeRecursively</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Directory removed.'</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></b><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h2 id="toc-copy-rename-move">Copying, renaming, and moving</h2>

  <p><code>FileEntry</code> and <code>DirectoryEntry</code> share common operations.</p>

  <h3 id="toc-dir-move-copy">Copying an entry</h3>

  <p>Both <code>FileEntry</code> and <code>DirectoryEntry</code> have a
  <code>copyTo()</code> for duplicating existing entries. This method automatically
  does a recursive copy on folders.</p>

  <p>The following code example copies the file "me.png" from one directory to another:</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> copy</span><span class="pun">(</span><span class="pln">cwd</span><span class="pun">,</span><span class="pln"> src</span><span class="pun">,</span><span class="pln"> dest</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  cwd</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="pln">src</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    cwd</span><span class="pun">.</span><span class="pln">getDirectory</span><span class="pun">(</span><span class="pln">dest</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">copyTo</span></b><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  copy</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/folder1/me.png'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'folder2/mypics/'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h3 id="toc-dir-move-rename">Moving or renaming an entry</h3>

  <p>The <code>moveTo()</code> method present in
  <code>FileEntry</code> and <code>DirectoryEntry</code>
  allows you to move or rename a file or directory.
  Its first argument is the parent directory to move the file under, and its second
  is an optional new name for the file. If a new name isn't provided, the file's
  original name is used.</p>

  <p>The following example renames "me.png" to "you.png", but does not move the file:</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> rename</span><span class="pun">(</span><span class="pln">cwd</span><span class="pun">,</span><span class="pln"> src</span><span class="pun">,</span><span class="pln"> newName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  cwd</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="pln">src</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">moveTo</span></b><span class="pun">(</span><span class="pln">cwd</span><span class="pun">,</span><span class="pln"> newName</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  rename</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">,</span><span class="pln"> </span><span class="str">'me.png'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'you.png'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <p>The following example moves "me.png" (located in the root directory) to
  a folder named "newfolder".</p>

  <pre class="prettyprint"><span class="kwd">function</span><span class="pln"> move</span><span class="pun">(</span><span class="pln">src</span><span class="pun">,</span><span class="pln"> dirName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getFile</span><span class="pun">(</span><span class="pln">src</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    fs</span><span class="pun">.</span><span class="pln">root</span><span class="pun">.</span><span class="pln">getDirectory</span><span class="pun">(</span><span class="pln">dirName</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">moveTo</span></b><span class="pun">(</span><span class="pln">dirEntry</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">

  </span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

window</span><span class="pun">.</span><span class="pln">requestFileSystem</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">TEMPORARY</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1024</span><span class="pun">*</span><span class="lit">1024</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  move</span><span class="pun">(</span><span class="str">'/me.png'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'newfolder/'</span><span class="pun">);</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> errorHandler</span><span class="pun">);</span></pre>

  <h2 id="toc-filesystemurls">filesystem: URLs</h2>

  <p>The FileSystem API exposes a new URL scheme, <code>filesystem:</code>,
  that can be used to fill <code>src</code> or <code>href</code> attributes.
  For example, if you wanted to display an image and have its
  <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-fileentry-interface"><code>fileEntry</code></a>,
  calling <code>toURL()</code> would give you the file's <code>filesystem:</code> URL:</p>

<pre class="prettyprint"><span class="kwd">var</span><span class="pln"> img </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">createElement</span><span class="pun">(</span><span class="str">'img'</span><span class="pun">);</span><span class="pln">
img</span><span class="pun">.</span><span class="pln">src </span><span class="pun">=</span><span class="pln"> </span><b><span class="pln">fileEntry</span><span class="pun">.</span><span class="pln">toURL</span></b><span class="pun">();</span><span class="pln"> </span><span class="com">// filesystem:http://example.com/temporary/myfile.png</span><span class="pln">
document</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="pln">appendChild</span><span class="pun">(</span><span class="pln">img</span><span class="pun">);</span></pre>

  <p>Alternatively, if you already have a <code>filesystem:</code> URL,
  <code>resolveLocalFileSystemURL()</code> will get you back the
  <a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/#the-fileentry-interface"><code>fileEntry</code></a>:</p>

<pre class="prettyprint"><span class="pln">window</span><span class="pun">.</span><span class="pln">resolveLocalFileSystemURL </span><span class="pun">=</span><span class="pln"> window</span><span class="pun">.</span><span class="pln">resolveLocalFileSystemURL </span><span class="pun">||</span><span class="pln">
                                   window</span><span class="pun">.</span><span class="pln">webkitResolveLocalFileSystemURL</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">var</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="str">'filesystem:http://example.com/temporary/myfile.png'</span><span class="pun">;</span><span class="pln">
</span><b><span class="pln">window</span><span class="pun">.</span><span class="pln">resolveLocalFileSystemURL</span></b><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">fileEntry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">...</span><span class="pln">
</span><span class="pun">});</span></pre>

  <h2 id="toc-dir-fullexample">Putting it all together</h2>

  <h3 id="toc-samples-basic">Basic example</h3>
  <p>This demo lists the files/folders in the filesystem.</p>

  
  <iframe src="./Exploring the FileSystem APIs - HTML5 Rocks_files/saved_resource.html" style="border: none; width: 100%; height: 460px;"></iframe>
  

  <h3 id="toc-samples-terminal">HTML5 Terminal</h3>
  <p>This shell replicates some of the common operations in a UNIX filesystem
  (such as <code>cd</code>, <code>mkdir</code>, <code>rm</code>, <code>open</code>,
  and <code>cat</code>) by abstracting the FileSystem API. To add content, open
  the app, then drag and drop files from your desktop onto the terminal window.</p>

  <!--<iframe id="terminal-iframe" src="terminal.html"></iframe>-->

  <figure>
    <a href="http://www.htmlfivewow.com/demos/terminal/terminal.html" target="_blank">
      <img src="./Exploring the FileSystem APIs - HTML5 Rocks_files/terminal.png" alt="Click to open the HTML5 Wow Terminal" title="Click to open the HTML5 Wow Terminal">
    </a>
    <figcaption>
      <a href="http://www.htmlfivewow.com/demos/terminal/terminal.html" target="_blank">Open the HTML5 Terminal</a>
    </figcaption>
  </figure>

  <h2 id="toc-usecases">Use Cases</h2>

  <p>There are several <a href="http://www.html5rocks.com/tutorials#offline,storage">storage options</a>
  available in HTML5, but the FileSystem is different in that it aims to satisfy
  client-side storage use cases not well served by databases. Generally, these
  are applications that deal with large binary blobs and/or share data with
  applications outside of the context of the browser.</p>

  <p>The specification lists several use cases:</p>
  <ol>
    <li>Persistent uploader
      <ul>
      <li>When a file or directory is selected for upload, it copies the files
      into a local sandbox and uploads a chunk at a time.</li>
      <li>Uploads can be restarted after browser crashes, network interruptions, etc.</li>
      </ul>
    </li>
    <li>Video game, music, or other app with lots of media assets
      <ul>
      <li>It downloads one or several large tarballs, and expands them locally
      into a directory structure.</li>
      <li>The same download works on any operating system.</li>
      <li>It can manage prefetching just the next-to-be-needed assets in
      the background, so going to the next game level or activating a new
      feature doesn't require waiting for a download.</li>
      <li>It uses those assets directly from its local cache, by direct
      file reads or by handing local URIs to image or video tags, WebGL asset loaders, etc.</li>
      <li>The files may be of arbitrary binary format.</li>
      <li>On the server side, a compressed tarball will often be much
      smaller than a collection of separately-compressed files. Also, 1
      tarball instead of 1000 little files will involve fewer seeks, all
      else being equal.</li>
      </ul>
    </li>
    <li>Audio/Photo editor with offline access or local cache for speed
      <ul>
      <li>The data blobs are potentially quite large, and are read-write.</li>
      <li>It may want to do partial writes to files (ovewriting just the
      ID3/EXIF tags, for example).</li>
      <li>The ability to organize project files by creating directories would be useful.</li>
      <li>Edited files should be accessable by client-side applications [iTunes, Picasa].
      </li></ul>
    </li>
    <li>Offline video viewer
      <ul>
      <li>It downloads large files (&gt;1GB) for later viewing.</li>
      <li>It needs efficient seek + streaming.</li>
      <li>It must be able to hand a URI to the video tag.</li>
      <li>It should enable access to partly-downloaded files e.g. to let
      you watch the first episode of the DVD even if your download didn't
      complete before you got on the plane.</li>
      <li>It should be able to pull a single episode out of the middle of
      a download and give just that to the video tag.</li>
      </ul>
    </li>
    <li>Offline Web Mail Client
      <ul>
      <li>Downloads attachments and stores them locally.</li>
      <li>Caches user-selected attachments for later upload.</li>
      <li>Needs to be able to refer to cached attachments and image
      thumbnails for display and upload.</li>
      <li>Should be able to trigger the UA's download manager just as if
      talking to a server.</li>
      <li>Should be able to upload an email with attachments as a
      multipart post, rather than sending a file at a time in an XHR.</li>
      </ul>
    </li>
  </ol>

  <h2 id="toc-references">Reference specifications</h2>
  <ul>
    <li><a href="http://dev.w3.org/2009/dap/file-system/pub/FileSystem/">FileSystem</a></li>
    <li><a href="http://dev.w3.org/2009/dap/file-system/file-writer.html">FileWriter</a></li>
    <li><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-filereader">FileReader</a></li>
    <li><a href="http://dev.w3.org/2006/webapi/FileAPI/">File</a></li>
    <li><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-Blob">Blob</a></li>
  </ul>




      </div>
    </section>
  </article>

  
  <section class="disqus pattern-bg-lighter">

    <div id="disqus" class="container">

      <h2>Comments</h2>

      <div id="disqus_thread">

        <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#disqus_thread" class="load-comments" data-disqus-identifier="http://www.html5rocks.com/tutorials/file/filesystem/">156</a>

      </div>
    </div>

    <noscript>
      &lt;p class="center"&gt;
        &lt;strong&gt;
          &lt;a href="http://disqus.com/?ref_noscript"&gt;Please enable JavaScript to view the comments powered by Disqus.&lt;/a&gt;
        &lt;/strong&gt;
      &lt;/p&gt;
    </noscript>

    <script>

      var disqus_shortname = 'html5rocks';
      var disqus_identifier = 'http://www.html5rocks.com/tutorials/file/filesystem/';
      var disqus_url = 'http://www.html5rocks.com/tutorials/file/filesystem/';
      var disqus_developer = 0;

      var disqus_config = function () {
        var funky_language_code_mapping = {
          'de': 'de_inf',
          'es': 'es_ES',
          'pt': 'pt_EU',
          'sr': 'sr_CYRL',
          'sv': 'sv_SE',
          'zh': 'zh_HANT'
        };
        this.language = funky_language_code_mapping['en'] ||
                        'en';

        this.callbacks.onReady = [ function () {
                                      try {
                                        ga('send', 'event', 'View comments');
                                      } catch(err){}
                                   } ];
        this.callbacks.onNewComment = [ function (comment) {
                                          try {
                                            ga('send', 'event', 'Commented');
                                          } catch(err){}
                                        } ];
      };

      window.addEventListener('load', function(e) {

        var c = document.createElement('script');
        c.type = 'text/javascript';
        c.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        c.async = true;

        var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
        sp.insertBefore(c, s);

        if (window.location.hash === '#disqus_thread')
          loadComments();

      }, false);

      var disqus_loaded = false;
      function loadComments() {

        if (disqus_loaded)
          return;

        disqus_loaded = true;

        ga('send', 'event', 'Interactions', 'Comments', 'Comments Loaded');

        var s = document.getElementsByTagName('script')[0], sp = s.parentNode;
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;

        var disqusContainer = document.getElementById('disqus');
        disqusContainer.classList.add('active');

        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        sp.insertBefore(dsq, s);
      }

      function outgoing(url) {
        try {
          ga('send', 'event', 'Outbound Links' , url);
        } catch(err){}
      }
      // Open external links (also that don't have a target defined) in a new tab.
      var externLinks = document.querySelectorAll('article.tutorial a[href^="http"]:not([target])');
      for(var i = 0, a; a = externLinks[i]; ++i) {
        a.target = '_blank';
        a.addEventListener('click', new Function('outgoing(' + '"' + a.href.replace(/.*?:\/\//g, "") + '"' + ');'));
      }

      var loadCommentsButtons = document.querySelectorAll('.load-comments');
      for(var l = 0; l < loadCommentsButtons.length; l++)
        loadCommentsButtons[l].addEventListener('click', loadComments);

    </script>
  </section>
  

  <footer>
    <div class="container">

      
        <h1>Next steps</h1>

        

        <aside class="panel share">
          <h2>Share</h2>

            <a href="https://twitter.com/share?url=http://www.html5rocks.com/tutorials/file/filesystem/&amp;text=Exploring%20the%20FileSystem%20APIs&amp;lang=en&amp;via=ChromiumDev&amp;related=ChromiumDev" class="twitter" target="_blank">Twitter</a>

            <a href="https://www.facebook.com/sharer/sharer.php?u=http://www.html5rocks.com/tutorials/file/filesystem/" class="facebook" target="_blank">Facebook</a>

            <a href="https://plus.google.com/share?url=http://www.html5rocks.com/tutorials/file/filesystem/" class="gplus" onclick="javascript:window.open(this.href, &#39;&#39;, &#39;menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600&#39;);return false;">Google+</a>

        </aside>

        <aside class="panel rss">
          <h2>Subscribe</h2>
          <p>Enjoyed this article? Grab the <a href="http://feeds.feedburner.com/html5rocks">RSS feed</a> and stay up-to-date.</p>
        </aside>

      

      <p class="licensing">
      
        Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License</a>, and code samples are licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
      
      </p>

    </div>
  </footer>

  <script>
    window.isCompatible = function() {
      
  return !!(window.requestFileSystem || window.webkitRequestFileSystem);

    };

    if (isCompatible() === false) {
      document.getElementById('notcompatible').className = '';
    }

    function _prettyPrint() {
      if (typeof customPrettyPrintLanguage != 'undefined') {
        customPrettyPrintLanguage();
      }
      prettyPrint();
    }
  </script>
  <script async="" src="./Exploring the FileSystem APIs - HTML5 Rocks_files/prettify.min.js" onload="_prettyPrint()"></script>
  <!-- Google Tag Manager -->
<noscript>&lt;iframe src="//www.googletagmanager.com/ns.html?id=GTM-XXXX"
height="0" width="0" style="display:none;visibility:hidden"&gt;&lt;/iframe&gt;</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MB3LRF');</script>
<!-- End Google Tag Manager -->


  </div>

  <script>
  (function() {

    // Kill feedburner and marketing tracking arguments, but let them register
    // before we do it.
    setTimeout(function() {
      if (/^\?utm_/.test(document.location.search) &&
          window.history.replaceState) {
        window.history.replaceState(
            {}, '', document.location.href.replace(/\?utm_.*/, ''));
      }
    }, 2000);

    var siteHeader = document.getElementById('siteheader');
    var navToggle = document.getElementById('navtoggle');
    var siteNav = document.getElementById('sitenav');

    function toggle(target, forceActive) {

      if (typeof toc !== 'undefined') {
        // Switch off whichever one is not the
        // current target
        if (target === toc)
          siteNav.classList.remove('active');
        else
          toc.classList.remove('active');
      }

      // Toggle if no force parameter is set
      if (typeof forceActive === 'undefined') {
        target.classList.toggle('active');
      } else {
        if (forceActive)
          target.classList.add('active');
        else
          target.classList.remove('active');
      }

      // now find out what the set state ended up being
      var isActive = target.classList.contains('active');

      if (isActive)
        siteHeader.classList.add('expanded');
      else
        siteHeader.classList.remove('expanded');

    }

    navToggle.addEventListener('click', function(e) {
      toggle(siteNav);
      e.preventDefault();
    });

    

    var tocToggle = document.getElementById('toctoggle');
    var toc = document.getElementById('toc');
    var articleMeta = document.getElementById('article-meta');
    var articleContent = document.getElementById('article-content');
    var articleMetaHeight = 0;
    var articleMetaMaxY = 0;
    var articleMetaMinY = 0;
    var articleContentPadding = 200;

    var tocLinks = document.querySelectorAll('.toc a');
    for (var t = 0; t < tocLinks.length; t++)
      tocLinks[t].addEventListener('click', onTocLinkClick);

    tocToggle.addEventListener('click', function(e) {
      toggle(toc);
      e.preventDefault();
    });

    toc.addEventListener('click', function(e) {
      if (e.target !== siteNav)
        toggle(toc, false);
    });

    function onTocLinkClick() {
      ga('send', 'event', 'Interactions', 'TOC', 'TOC Clicked');
    }

    function setMinScrollYFromMetaY() {
      var scrollPosition = window.scrollY;

      var articleMetaBounds = articleMeta.getBoundingClientRect();
      var articleMetaTop = Math.max(352,
          articleMetaBounds.top - 20 + scrollPosition);

      articleMetaHeight = articleMetaBounds.bottom - articleMetaBounds.top;
      articleMetaMinY = articleMetaTop;
    }

    function setMaxScrollYFromContentHeight() {

      var scrollPosition = window.scrollY;

      var articleContentBounds = articleContent.getBoundingClientRect();
      var articleContentTop = articleContentBounds.top + scrollPosition;
      var articleContentHeight = articleContentBounds.bottom - articleContentBounds.top;

      articleMetaMaxY = articleContentTop +
          articleContentHeight -
          articleMetaHeight -
          articleContentPadding;

    }

    function onScroll(e) {

      if (window.scrollY >= articleMetaMinY) {

        articleMeta.classList.add('sticky');

        var articleMetaTop = 22 - Math.max(0, window.scrollY - articleMetaMaxY);
        articleMeta.style.top = articleMetaTop + 'px';

      } else {
        articleMeta.classList.remove('sticky');
        articleMeta.style.top = 'auto';
      }
    }

    if (articleMeta.getBoundingClientRect) {
      setMinScrollYFromMetaY();
      setMaxScrollYFromContentHeight();
      document.addEventListener('scroll', onScroll);
      window.addEventListener('load', setMaxScrollYFromContentHeight, false);
    }

    
  })();
  </script>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-15028909-1', 'auto');
  ga('create', 'UA-49880327-4', 'auto', {'name': 'html5rocks'});

  ga('send', 'pageview');
  ga('html5rocks.send', 'pageview');

  </script>
   <!-- Google Tag Manager -->
<noscript>&lt;iframe src="//www.googletagmanager.com/ns.html?id=GTM-XXXX"
height="0" width="0" style="display:none;visibility:hidden"&gt;&lt;/iframe&gt;</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MB3LRF');</script>
<!-- End Google Tag Manager -->


</body></html>